<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{pageTitle}}</title>
  <!-- 自定义样式 -->
  <style>
    .layui-form-label {
      width: 15% !important;
      margin-left: 1%;
    }
    .layui-input-inline, .layui-input-block {
      width: 33% !important;
    }
  </style>
</head>
<body>

<!-- 头部导航 -->
<div class="layui-card-header layui-card">
  <span class="layui-breadcrumb" lay-filter="breadcrumb">
    <a lay-href="">首页</a>
    <a>{{moduleName}}</a>
    <a><cite>{{pageName}}</cite></a>
  </span>
</div>

<!-- 主要内容区 -->
<div class="layui-fluid">
  <div class="layui-card">
    <div class="layui-tab layui-tab-brief">
      <ul class="layui-tab-title">
        <li class="layui-this">{{tabTitle}}</li>
      </ul>
      <div class="layui-tab-content">
        <!-- 编辑表单 -->
        <form class="layui-form layui-form-pane" lay-filter="editForm" id="editForm">

          <!-- 隐藏ID字段 -->
          <input type="hidden" id="id" name="id">

          <!-- 基础信息区域 -->
          <fieldset class="layui-elem-field layui-field-title">
            <legend>基础信息</legend>
          </fieldset>

          <div class="layui-form-item" pane>
            <label class="layui-form-label">名称 <span style="color:red">*</span></label>
            <div class="layui-input-inline">
              <input type="text" name="name" lay-verify="required" placeholder="请输入名称" class="layui-input">
            </div>
          </div>

          <div class="layui-form-item" pane>
            <label class="layui-form-label">编码 <span style="color:red">*</span></label>
            <div class="layui-input-inline">
              <input type="text" name="code" lay-verify="required" placeholder="请输入编码" class="layui-input">
            </div>
          </div>

          <div class="layui-form-item" pane>
            <label class="layui-form-label">类型</label>
            <div class="layui-input-inline">
              <select name="type" lay-verify="required">
                <option value="">请选择</option>
                <option value="1">类型1</option>
                <option value="2">类型2</option>
                <option value="3">类型3</option>
              </select>
            </div>
          </div>

          <div class="layui-form-item" pane>
            <label class="layui-form-label">状态</label>
            <div class="layui-input-inline">
              <input type="radio" name="status" value="1" title="启用" checked>
              <input type="radio" name="status" value="0" title="禁用">
            </div>
          </div>

          <!-- 业务信息区域 -->
          <fieldset class="layui-elem-field layui-field-title">
            <legend>业务信息</legend>
          </fieldset>

          <div class="layui-form-item" pane>
            <label class="layui-form-label">{{fieldLabel1}}</label>
            <div class="layui-input-inline">
              <input type="text" name="{{fieldName1}}" placeholder="请输入{{fieldLabel1}}" class="layui-input">
            </div>
          </div>

          <div class="layui-form-item" pane>
            <label class="layui-form-label">{{fieldLabel2}}</label>
            <div class="layui-input-inline">
              <input type="text" name="{{fieldName2}}" placeholder="请输入{{fieldLabel2}}" class="layui-input">
            </div>
          </div>

          <div class="layui-form-item" pane>
            <label class="layui-form-label">{{fieldLabel3}}</label>
            <div class="layui-input-inline">
              <select name="{{fieldName3}}">
                <option value="">请选择</option>
                {{selectOptions}}
              </select>
            </div>
          </div>

          <!-- 金额/数字字段 -->
          <div class="layui-form-item" pane>
            <label class="layui-form-label">{{amountLabel}}</label>
            <div class="layui-input-inline">
              <input type="number" name="{{amountField}}" placeholder="请输入金额" class="layui-input" lay-verify="number">
            </div>
          </div>

          <!-- 描述信息 -->
          <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">描述</label>
            <div class="layui-input-block">
              <textarea name="remark" placeholder="请输入描述信息" class="layui-textarea"></textarea>
            </div>
          </div>

          <!-- 操作按钮 -->
          <div class="layui-form-item">
            <div class="layui-input-block">
              <button class="layui-btn" lay-submit lay-filter="saveBtn">
                <i class="layui-icon layui-icon-ok"></i> 保存
              </button>
              <button type="reset" class="layui-btn layui-btn-primary">
                <i class="layui-icon layui-icon-refresh"></i> 重置
              </button>
              <button type="button" class="layui-btn layui-btn-primary" id="backBtn">
                <i class="layui-icon layui-icon-return"></i> 返回
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
layui.use(['form','admin','laydate'], function(){
  var form = layui.form
    ,admin = layui.admin
    ,laydate = layui.laydate
    ,$ = layui.$;

  // 自定义验证规则
  form.verify({
    amount: [
      /^(([1-9]\d*)|\d)(\.\d{1,2})?$/,
      '金额格式不正确，最多两位小数'
    ],
    phone: [
      /^1[3-9]\d{9}$/,
      '手机号格式不正确'
    ],
    email: [
      /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,
      '邮箱格式不正确'
    ]
  });

  // 如果是编辑模式，加载数据
  var editId = layui.router().search.id;
  if(editId) {
    admin.req({
      type: 'get',
      url: layui.setter.baseUrl + '/api/{{getDetailPath}}',
      data: {id: editId},
      success: function(res){
        if(res.code == 0){
          var data = res.data;

          // 填充表单数据
          $('#id').val(data.id);
          $('input[name="name"]').val(data.name);
          $('input[name="code"]').val(data.code);
          $('input[name="status"][value="'+data.status+'"]').prop('checked', true);
          $('select[name="type"]').val(data.type);
          $('input[name="{{fieldName1}}"]').val(data.{{fieldName1}});
          $('input[name="{{fieldName2}}"]').val(data.{{fieldName2}});
          $('select[name="{{fieldName3}}"]').val(data.{{fieldName3}});
          $('input[name="{{amountField}}"]').val(data.{{amountField}});
          $('textarea[name="remark"]').val(data.remark);

          // 重新渲染表单
          form.render();
        } else {
          layer.alert(res.msg || '获取数据失败', {title: '错误提示'});
        }
      },
      error: function(err){
        layer.alert(JSON.stringify(err), {title: '错误提示'});
      }
    });
  }

  // 监听提交
  form.on('submit(saveBtn)', function(data){
    var formData = data.field;

    // 添加ID（编辑模式）
    if($('#id').val()) {
      formData.id = $('#id').val();
    }

    admin.req({
      type: 'post',
      url: layui.setter.baseUrl + '/api/{{savePath}}',
      data: formData,
      done: function(res){
        // 注意：如果使用 admin.req 的 done 回调，请确保返回格式正确
        if(res.code == 0){
          layer.alert(res.msg || '保存成功', {title: '提示'}, function(index){
            layer.close(index);
            // 返回列表页
            location.hash = '/{{listPath}}/';
          });
        } else {
          layer.alert(res.msg || '保存失败', {title: '错误提示'});
        }
      }
    });

    return false; // 阻止表单跳转
  });

  // 返回按钮
  $('#backBtn').on('click', function(){
    history.back();
  });

  // 表单渲染
  form.render();
});
</script>
</body>
</html>
