# 代理系统说明

dtg-java-skill 插件使用智能代理系统来提供专业化的开发支持。

## 代理架构

插件采用多代理协作架构，每个代理专注于特定的任务领域。

```
用户请求
    ↓
[路由层] → 根据请求类型分发到相应代理
    ↓
┌─────────────┬─────────────┬─────────────┐
│ 需求分析代理 │ 任务执行代理 │ 代码审查代理 │
├─────────────┼─────────────┼─────────────┤
│ 问题诊断代理 │ 架构分析代理 │ 上下文管理代理 │
└─────────────┴─────────────┴─────────────┘
    ↓
[结果整合] → 汇总所有代理的输出
    ↓
用户响应
```

## 代理类型

### 1. 需求分析代理 (requirement-analyzer)

**文件**: `agents/requirement-analyzer.md`

**工具**: Read, Glob, Grep, TodoWrite, WebSearch

**职责**:
- 分析用户需求
- 评估任务规模
- 确定微服务边界
- 识别依赖关系

**触发条件**:
- 用户描述新功能需求
- 询问实现方案
- 请求影响分析

**输出**:
- 需求拆解
- 工作量评估
- 实施计划
- 风险提示

### 2. 任务执行代理 (task-executor)

**文件**: `agents/task-executor.md`

**工具**: Read, Write, Edit, Glob, Grep, Bash, TodoWrite

**职责**:
- 生成项目代码
- 创建配置文件
- 实现业务逻辑
- 添加测试代码

**触发条件**:
- 明确的代码生成请求
- 功能实现指令
- 重构任务

**输出**:
- 源代码文件
- 配置文件
- 测试代码
- 文档说明

### 3. 代码审查代理 (code-reviewer)

**文件**: `agents/code-reviewer.md`

**工具**: Read, Glob, Grep, Bash, TodoWrite, Task

**模型**: sonnet

**职责**:
- 执行代码审查
- 检查代码质量
- 识别安全问题
- 提供改进建议

**触发条件**:
- "code review"
- "审查代码"
- Git commit 触发

**输出**:
- 审查报告
- 问题清单
- 修复建议
- 最佳实践对比

### 4. 问题诊断代理 (intelligent-diagnoser)

**文件**: `agents/intelligent-diagnoser.md`

**工具**: Read, Glob, Grep, Bash, TodoWrite

**模型**: sonnet

**职责**:
- 诊断代码问题
- 识别性能瓶颈
- 分析并发问题
- 评估安全风险

**触发条件**:
- "diagnose"
- "诊断问题"
- 性能问题报告

**输出**:
- 问题诊断报告
- 根因分析
- 修复方案
- 预防建议

### 5. 架构分析代理 (architecture-analyzer)

**文件**: `agents/architecture-analyzer.md`

**工具**: Read, Glob, Grep, Bash, TodoWrite

**模型**: sonnet

**职责**:
- 评估微服务架构
- 分析服务边界
- 识别架构模式
- 提供优化建议

**触发条件**:
- "analyze architecture"
- "分析架构"
- 架构评审

**输出**:
- 架构评估报告
- 服务边界分析
- 模式识别结果
- 演进建议

### 6. 上下文管理代理 (module-context-manager)

**文件**: `agents/module-context-manager.md`

**工具**: Read, Glob, Grep, Bash

**职责**:
- 管理项目上下文
- 追踪模块依赖
- 维护技术栈信息
- 更新项目状态

**触发条件**:
- 项目结构变化
- 新增/删除模块
- 技术栈更新

**输出**:
- 上下文快照
- 依赖关系图
- 模块清单
- 技术栈报告

## 代理协作流程

### 单代理模式

适用于简单任务：
```
用户请求 → 单个代理 → 直接响应
```

示例:
```
用户: "创建一个用户服务"
    ↓
[任务执行代理]
    ↓
生成用户服务代码
```

### 多代理协作

适用于复杂任务：
```
用户请求 → 主代理协调 → 子代理执行 → 结果整合
```

示例:
```
用户: "实现完整的支付功能并审查代码"
    ↓
[需求分析] → 分析需求、确定方案
    ↓
[任务执行] → 生成代码、实现功能
    ↓
[代码审查] → 审查代码、检查质量
    ↓
[架构分析] → 评估架构、提供建议
    ↓
整合所有结果 → 综合报告
```

### 代理链模式

适用于跨领域任务：
```
用户请求 → 代理1 → 代理2 → 代理3 → 最终结果
```

示例:
```
用户: "优化我的微服务架构"
    ↓
[架构分析] → 识别架构问题
    ↓
[问题诊断] → 深入诊断问题
    ↓
[任务执行] → 实施优化方案
    ↓
优化完成报告
```

## 代理触发条件

### 自动触发

某些代理会在特定条件下自动触发：
- Git 提交时自动触发代码审查
- 检测到性能问题时自动触发诊断
- 项目结构变化时自动触发上下文更新

### 手动触发

用户可以通过关键词手动触发：
- "review" / "审查" → 代码审查代理
- "analyze" / "分析" → 架构分析代理
- "diagnose" / "诊断" → 问题诊断代理

### 条件触发

根据任务复杂度自动选择：
- 简单任务 → 单代理处理
- 中等任务 → 2-3 个代理协作
- 复杂任务 → 全部代理参与

## 代理工具集

每个代理配备专门工具集：

### 读取工具
- **Read**: 读取文件内容
- **Glob**: 文件模式匹配
- **Grep**: 内容搜索

### 执行工具
- **Write**: 创建新文件
- **Edit**: 编辑现有文件
- **Bash**: 执行命令

### 管理工具
- **TodoWrite**: 任务追踪
- **Task**: 启动子代理

## 代理扩展

您可以创建自定义代理：

1. 在 `agents/` 目录创建新的 `.md` 文件
2. 定义代理的 YAML frontmatter
3. 编写代理的职责和流程
4. 指定需要的工具集

示例:
```markdown
---
name: custom-agent
description: 自定义代理描述
tools: [Read, Glob, Grep, Bash, TodoWrite]
model: sonnet
---

# 自定义代理

## 职责
描述代理的职责范围

## 工作流程
1. 步骤1
2. 步骤2

## 输出格式
定义输出模板
```

## 代理配置

代理可以在项目级配置：

```yaml
# .claude/dtg-java-skill.local.md
---
agents:
  codeReview:
    enabled: true
    severity: "high"
    autoTrigger: true

  architectureAnalysis:
    enabled: true
    dddStrict: true

  problemDiagnosis:
    enabled: true
    performanceThreshold: "medium"
---
```

## 代理监控

插件会跟踪代理的使用情况：
- 调用次数
- 执行时间
- 成功率
- 用户满意度

这些指标可用于优化代理性能。

---

**了解更多**: 查看 [智能功能指南](intelligent-features.md) 了解各代理的详细功能。
