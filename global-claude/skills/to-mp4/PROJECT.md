# to-mp4 Skill 项目概述

## 项目简介

**to-mp4** 是一个功能强大的视频转换工具，专门用于将 MOV 格式视频转换为 MP4 格式并进行智能压缩。该 skill 使用 Python 和 FFmpeg 构建，提供了丰富的命令行选项和预设方案，适合各种使用场景。

## 核心功能

### 1. 视频格式转换
- MOV → MP4 格式转换
- 支持 H.264 和 H.265 编码
- 自动处理音频编码（AAC、MP3）
- 保持宽高比的分辨率调整

### 2. 智能压缩
- 可调节画质（CRF 18-28）
- 多种编码速度选项（ultrafast 到 veryslow）
- 音频比特率控制
- 分辨率自动缩放

### 3. Web 优化
- Faststart 支持（流式播放）
- 兼容性优化
- 适合在线分发

### 4. 视频分析
- 显示视频详细信息
- 帮助选择最佳转换参数

## 文件结构

```
to-mp4/
├── SKILL.md                 # Skill 定义文件（Claude Code 识别）
├── README.md                # 完整使用文档
├── QUICKSTART.md            # 5 分钟快速开始指南
├── USAGE_EXAMPLES.md        # 详细使用示例
├── PROJECT.md               # 项目概述（本文件）
└── scripts/
    ├── convert_to_mp4.py    # 主转换脚本（404 行）
    └── test_skill.py        # 测试脚本
```

**统计信息：**
- 总代码行数：1,794 行
- Python 代码：404 行（主脚本）
- 文档：1,390 行
- 支持的编码格式：H.264、H.265
- 支持的音频编码：AAC、MP3、Copy

## 技术栈

### 核心技术
- **Python 3.6+**: 脚本语言
- **FFmpeg 4.0+**: 视频处理引擎
- **argparse**: 命令行参数解析
- **subprocess**: FFmpeg 调用

### 关键特性
- 跨平台支持（macOS、Linux、Windows）
- 自动检测 FFmpeg 安装
- 详细的错误处理和提示
- 进度显示和文件大小对比

## 使用场景

### 1. 日常视频压缩
iPhone、Mac 等设备录制的 MOV 视频通常很大，转换后可以：
- 节省存储空间（压缩率 85-95%）
- 方便分享和传输
- 保持良好的画质

### 2. Web 内容准备
准备上传到网站或在线平台的视频：
- Web 优化（faststart）
- 最佳兼容性（H.264）
- 合理的文件大小

### 3. 长期存档
使用 H.265 编码进行长期存档：
- 最大化压缩率
- 节省存储成本
- 保持可接受的画质

### 4. 批量处理
生成多个不同质量的版本：
- 4K 原始版本
- 1080p 分享版本
- 720p 预览版本
- 480p 快速预览

## 典型效果

| 输入 | 输出方案 | 文件大小 | 压缩率 |
|------|---------|---------|--------|
| 2GB MOV (4K ProRes) | H.264 CRF23 | ~300MB | 85% |
| 2GB MOV (4K ProRes) | H.264 CRF23 1080p | ~150MB | 92.5% |
| 2GB MOV (4K ProRes) | H.265 CRF28 | ~200MB | 90% |

## 快速开始

### 安装 FFmpeg
```bash
# macOS
brew install ffmpeg

# Ubuntu/Debian
sudo apt install ffmpeg
```

### 基本转换
```bash
python scripts/convert_to_mp4.py video.mov
```

### 高级选项
```bash
# 高质量
python scripts/convert_to_mp4.py video.mov -crf 18

# 高压缩率
python scripts/convert_to_mp4.py video.mov -c h265 -crf 28

# 4K 转 1080p
python scripts/convert_to_mp4.py video.mov -s 1920
```

## 参数说明

### 视频编码（-c）
- `h264`: 最佳兼容性，推荐大多数场景
- `h265`: 更高压缩率，适合存储和 Apple 设备

### 画质控制（-crf）
- `18`: 接近无损，文件较大
- `23`: 推荐（默认），画质与体积平衡
- `28`: 高压缩率，画质有所下降

### 编码速度（-p）
- `ultrafast`: 最快，压缩率最低
- `fast`: 快速，日常使用
- `slow`: 推荐，压缩率好
- `veryslow`: 最慢，压缩率最佳

### 分辨率调整（-s）
- `1920`: 缩放到 1080p
- `1280`: 缩放到 720p
- `854`: 缩放到 480p

### 音频设置
- `-ac aac`: AAC 编码（默认，最佳兼容性）
- `-ac libmp3lame`: MP3 编码
- `-ac copy`: 复制原始音频
- `-ab 128k`: 音频比特率（默认 128k）

### Web 优化
- `--faststart`: 启用 Web 优化，支持流式播放

## 文档说明

### SKILL.md
- Claude Code skill 定义文件
- 包含 skill 触发条件和描述
- 完整的功能说明和参数列表

### README.md
- 完整的使用文档
- 所有命令行选项说明
- 常见问题解答
- 技术细节和 FFmpeg 参数说明

### QUICKSTART.md
- 5 分钟快速上手指南
- 常用命令速查表
- 典型压缩效果参考
- 推荐设置

### USAGE_EXAMPLES.md
- 21+ 个实际使用示例
- 各种场景的完整命令
- 故障排查指南
- 最佳实践

## 测试

运行测试脚本验证安装：

```bash
python scripts/test_skill.py
```

测试项目：
1. FFmpeg 安装检查
2. 转换脚本存在性
3. 脚本帮助功能
4. 文档文件完整性

## 设计原则

### 1. 易用性
- 简单的默认设置
- 清晰的命令行界面
- 详细的帮助信息
- 友好的错误提示

### 2. 灵活性
- 丰富的参数选项
- 支持多种编码格式
- 可调节的画质控制
- 灵活的音频设置

### 3. 性能
- 高效的 FFmpeg 调用
- 智能的参数配置
- 合理的默认值
- 多种预设方案

### 4. 兼容性
- 跨平台支持
- 多种编码格式
- Web 优化选项
- 广泛的播放器支持

## 未来改进

### 可能的功能增强
1. **批量处理**: 支持一次性转换多个文件
2. **预设管理**: 保存和加载自定义预设
3. **进度条**: 显示实时转换进度
4. **GPU 加速**: 支持 NVIDIA/AMD GPU 加速
5. **配置文件**: 支持配置文件存储常用设置
6. **视频裁剪**: 支持裁剪视频片段
7. **水印添加**: 支持添加水印
8. **字幕处理**: 支持字幕嵌入和提取

### 可能的优化
1. **并行处理**: 多核 CPU 并行编码
2. **智能参数**: 根据视频自动选择最佳参数
3. **质量预测**: 预估转换后质量和文件大小
4. **缓存机制**: 避免重复转换

## 贡献指南

### 报告问题
如果遇到问题，请提供：
- 操作系统和版本
- FFmpeg 版本
- Python 版本
- 完整的错误信息
- 使用的命令

### 改进建议
欢迎提出改进建议和新功能想法。

## 许可证

MIT License - 自由使用、修改和分发

## 致谢

- **FFmpeg**: 强大的视频处理框架
- **Python**: 优秀的脚本语言
- **Claude Code**: AI 辅助开发工具

## 联系方式

如有问题或建议，请通过项目的 issue tracker 反馈。

---

**最后更新**: 2026-02-01
**版本**: 1.0.0
**状态**: 生产就绪
